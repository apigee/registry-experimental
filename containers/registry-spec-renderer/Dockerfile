# Token to fetch the Typescript autogenerated library for Registry APIs
ARG NPM_AUTH_TOKEN=

#builder stage so we do not set the auth token to the final build image
FROM launcher.gcr.io/google/nodejs as builder
ARG NPM_AUTH_TOKEN
ENV NPM_AUTH_TOKEN=${NPM_AUTH_TOKEN}
COPY . /app/
RUN npm --unsafe-perm install


FROM launcher.gcr.io/google/nodejs
ENV NPM_AUTH_TOKEN=""
ENV PORT=80
ENV APG_REGISTRY_ADDRESS=apigeeregistry.googleapis.com:443

COPY --from=builder /app /app