# JavaScript Linter Plugin Sample

This directory contains a sample JavaScript program that works
as a plugin for the registry tool.

** WARNING: this is probably fragile and poorly-written JavaScript - PRs and issues are welcome! **

## Protocol Buffer Support

Message serialization requires JavaScript support code which is generated by 
`pbjs` tool (part of [protobuf.js](https://www.npmjs.com/package/protobufjs)).
The generation will be done automatically after `npm install` and the resulting
`.js` file will be placed into `pbjs-genfiles/` folder.

## Instructions

To run the sample, first clone the `registry` project into your home directory.
We'll need this to get protos used by the plugin.

Then clone this repository and `cd` to this directory.

Build the code:
```
npm install
```

Install the styleguide into your registry:
```
registry apply -f sample-styleguide.yaml
```

To run the linter, first edit `registry-lint-js` to use the full absolute
path to `src/index.js`.
 
Copy `registry-lint-js` somewhere on your search path ("." won't work,
when the linter is run, it runs in a temporary directory containing the
downloaded spec).

Compute conformance with `registry compute conformance`. For example:
```
registry compute conformance apis/wordnik.com/versions/4.0/specs/openapi
```

Be sure that your target spec's MIME type is included in the style guide's
`mimetypes` list.

View the results of your run with `registry get`.
```
registry get apis/wordnik.com/versions/4.0/specs/openapi/artifacts/conformance-sample-styleguide -o yaml
```

Here's what I get for that:
```
$ registry get apis/wordnik.com/versions/4.0/specs/openapi/artifacts/conformance-sample-styleguide -o yaml
apiVersion: apigeeregistry/v1
kind: ConformanceReport
metadata:
  name: conformance-sample-styleguide
  parent: apis/wordnik.com/versions/4.0/specs/openapi
data:
  styleguide: projects/menagerie/locations/global/artifacts/sample-styleguide
  guidelineReportGroups:
    - state: STATE_UNSPECIFIED
      guidelineReports: []
    - state: PROPOSED
      guidelineReports: []
    - state: ACTIVE
      guidelineReports:
        - guidelineId: active
          ruleReportGroups:
            - severity: SEVERITY_UNSPECIFIED
              ruleReports: []
            - severity: ERROR
              ruleReports:
                - ruleId: description-less-than-1000-chars
                  spec: projects/menagerie/locations/global/apis/wordnik.com/versions/4.0/specs/openapi@e70a3cc7
                  file: swagger.yaml
                  suggestion: keep API-ing!
                  location:
                    startPosition:
                      lineNumber: 2
                      columnNumber: 3
                    endPosition:
                      lineNumber: 4
                      columnNumber: 5
                  displayName: Description Maximum Length
                  description: Descriptions should not be too long.
                  docUri: https://github.com/apigee/registry
                - ruleId: description-contains-no-tags
                  spec: projects/menagerie/locations/global/apis/wordnik.com/versions/4.0/specs/openapi@e70a3cc7
                  file: swagger.yaml
                  suggestion: keep API-ing!
                  location:
                    startPosition:
                      lineNumber: 2
                      columnNumber: 3
                    endPosition:
                      lineNumber: 4
                      columnNumber: 5
                  displayName: Description Tags
                  description: Descriptions should not contain HTML tags.
                  docUri: https://github.com/apigee/registry
            - severity: WARNING
              ruleReports: []
            - severity: INFO
              ruleReports: []
            - severity: HINT
              ruleReports: []
    - state: DEPRECATED
      guidelineReports: []
    - state: DISABLED
      guidelineReports: []
```
